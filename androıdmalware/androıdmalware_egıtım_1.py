import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import os

root = r"C:\Users\İSO\Desktop\VERI_SETLERI\androıdmalware"

main_path   = os.path.join(root, "drebin-215-dataset-5560malware-9476-benign.csv")
main_clean  = main_path.replace(".csv", "_1.csv")

df = pd.read_csv(main_path, low_memory=False)
df.columns = df.columns.str.strip()
print(" Ana veri boyutu:", df.shape)

# sorunlu değerleri temizle
df.replace(['?', 'Infinity', '-Infinity'], np.nan, inplace=True)
df['class'] = df['class'].map({'B': 0, 'S': 1})
df.dropna(inplace=True)

df.to_csv(main_clean, index=False)
print(" Temiz ana veri kaydedildi:", main_clean)

cat_path   = os.path.join(root, "dataset-features-categories.csv")
cat_clean  = cat_path.replace(".csv", "_1.csv")

cat = pd.read_csv(cat_path, header=None, names=["Feature", "Category"])
cat.dropna(inplace=True)
cat.to_csv(cat_clean, index=False)
print(" Temiz kategori tablosu kaydedildi:", cat_clean)

plt.figure(figsize=(10,6))
cat['Category'].value_counts().plot(kind='bar', color='steelblue')
plt.title("Öznitelik Kategorisi Dağılımı")
plt.xlabel("Kategori")
plt.ylabel("Özellik Sayısı")
plt.xticks(rotation=45, ha='right')
plt.tight_layout()
plt.savefig(os.path.join(root, "feature_category_bar.png"))
plt.close()
print(" feature_category_bar.png grafiği oluşturuldu.")
