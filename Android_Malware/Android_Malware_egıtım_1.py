import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
import os

root      = r"C:\Users\İSO\Desktop\VERI_SETLERI\Android_Malware"
raw_path  = os.path.join(root, "Android_Malware.csv")
clean_path= os.path.join(root, "Android_Malware_1.csv")


df = pd.read_csv(raw_path, low_memory=False)
df.columns = df.columns.str.strip()          # baştaki/sondaki boşluklar

print(" Ham veri boyutu:", df.shape)
print(" İlk 3 satır:\n", df.head(3))

#Gereksiz sütunları at
drop_cols = ['Unnamed: 0','Flow ID','Source IP','Destination IP',
             'Source Port','Destination Port','Timestamp']
df.drop(columns=drop_cols, inplace=True, errors='ignore')

#  Hesap tipi karışık 3 sütunu sayıya çevir
for col in ['CWE Flag Count','Down/Up Ratio','Fwd Avg Bytes/Bulk']:
    if col in df.columns:
        df[col] = pd.to_numeric(df[col], errors='coerce')

#  '?' / sonsuzluk temizliği ve eksik satırı at
df.replace(['?','Infinity','-Infinity',np.inf,-np.inf], np.nan, inplace=True)
df.dropna(inplace=True)

# 6) Label’ı 0-1-2-3 yap
lab_map = {
    'Android_Adware':0,
    'Android_Scareware':1,
    'Android_SMS_Malware':2,
    'Benign':3
}
df['Label'] = df['Label'].map(lab_map)

print("\n Temizlenmiş satır/sütun:", df.shape)
print(" Sınıf dağılımı:\n", df['Label'].value_counts())

plt.figure(figsize=(6,4))
sns.countplot(x=df['Label'])
plt.title("Android_Malware Sınıf Dağılımı (Temiz)")
plt.xlabel("Label (0=Adware,1=Scareware,2=SMS,3=Benign)")
plt.ylabel("Örnek sayısı")
plt.tight_layout()
plt.savefig(os.path.join(root, "Android_Malware_clean_label_dist.png"))
plt.close()

#  Temiz CSV kaydet
df.to_csv(clean_path, index=False)
print("\n Temiz veri kaydedildi →", clean_path)
